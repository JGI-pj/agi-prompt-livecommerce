#!/usr/bin/env python3
"""
ãƒ©ã‚¤ãƒ–ã‚³ãƒãƒ¼ã‚¹å°æœ¬åˆ¶ä½œã‚·ã‚¹ãƒ†ãƒ  - ãƒ¡ã‚¤ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
ä¸¦åˆ—å‡¦ç†å¯¾å¿œç‰ˆ
"""

import os
import sys
import random
import string
import datetime
import shutil
from pathlib import Path
import time
import json

class LiveCommerceScriptGenerator:
    def __init__(self):
        self.base_dir = Path.cwd()
        self.sessions_dir = self.base_dir / "sessions"
        self.session_id = None
        self.product_url = None
        self.product_name = None
        
    def generate_session_id(self):
        """ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªã‚»ãƒƒã‚·ãƒ§ãƒ³IDã‚’ç”Ÿæˆ"""
        while True:
            # è‹±å­—2æ–‡å­— + æ•°å­—3æ–‡å­—ã®å½¢å¼
            letters = ''.join(random.choices(string.ascii_uppercase, k=2))
            numbers = ''.join(random.choices(string.digits, k=3))
            session_id = f"{letters}{numbers}"
            
            # é‡è¤‡ãƒã‚§ãƒƒã‚¯
            if not (self.sessions_dir / session_id).exists():
                return session_id
                
    def create_session_directories(self):
        """ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆ"""
        session_path = self.sessions_dir / self.session_id
        session_path.mkdir(parents=True, exist_ok=True)
        (session_path / "phase1").mkdir(exist_ok=True)
        (session_path / "phase2").mkdir(exist_ok=True)
        
    def initialize_session(self):
        """ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’åˆæœŸåŒ–"""
        self.session_id = self.generate_session_id()
        self.create_session_directories()
        
        print(f"""
å°æœ¬åˆ¶ä½œã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’é–‹å§‹ã—ã¾ã™ã€‚

ã‚»ãƒƒã‚·ãƒ§ãƒ³IDï¼š{self.session_id}
ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼šsessions/{self.session_id}/

ã“ã‚Œã‚ˆã‚Šã€ä»¥ä¸‹ã®2ãƒ•ã‚§ãƒ¼ã‚ºã§å°æœ¬ã‚’ä½œæˆã—ã¾ã™ï¼š
- Phase1ï¼šå¸‚å ´èª¿æŸ»ãƒ»ãƒšãƒ«ã‚½ãƒŠè¨­è¨ˆãƒ»è¨´æ±‚è»¸è¨­è¨ˆ
- Phase2ï¼šå°æœ¬ä½œæˆãƒ»æœ€çµ‚ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆ

å•†å“ã®URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚
""")
        
    def save_file(self, phase, filename, content):
        """ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜"""
        file_path = self.sessions_dir / self.session_id / phase / filename
        file_path.parent.mkdir(parents=True, exist_ok=True)
        with open(file_path, 'w', encoding='utf-8') as f:
            f.write(content)
        return file_path
        
    def read_file(self, phase, filename):
        """ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿"""
        file_path = self.sessions_dir / self.session_id / phase / filename
        if file_path.exists():
            with open(file_path, 'r', encoding='utf-8') as f:
                return f.read()
        return None
        
    def clean_phase_directory(self, phase):
        """ãƒ•ã‚§ãƒ¼ã‚ºãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—"""
        phase_dir = self.sessions_dir / self.session_id / phase
        if phase_dir.exists():
            shutil.rmtree(phase_dir)
        phase_dir.mkdir(parents=True, exist_ok=True)
        
    def execute_phase1_step1(self):
        """Phase1 ã‚¹ãƒ†ãƒƒãƒ—1: å¸‚å ´èª¿æŸ»"""
        print("\nã€ã‚¹ãƒ†ãƒƒãƒ—1ï¼šå¸‚å ´èª¿æŸ»ã‚’é–‹å§‹ã—ã¾ã™ã€‘")
        
        # å¸‚å ´èª¿æŸ»ã®30é …ç›®ã‚’å®Ÿè¡Œï¼ˆãƒ‡ãƒ¢ç”¨ã®ç°¡ç•¥ç‰ˆï¼‰
        research_content = f"""# å¸‚å ´èª¿æŸ»ãƒ¬ãƒãƒ¼ãƒˆ

å•†å“URL: {self.product_url}
èª¿æŸ»æ—¥: {datetime.datetime.now().strftime('%Yå¹´%mæœˆ%dæ—¥')}
ã‚»ãƒƒã‚·ãƒ§ãƒ³ID: {self.session_id}

## A. å•†å“ãã®ã‚‚ã®ã«é–¢ã™ã‚‹é …ç›®ï¼ˆ10é …ç›®ï¼‰

### 1. å•†å“åãƒ»å‹ç•ª
{self.product_name}

### 2. ä¾¡æ ¼å¸¯
- å®šä¾¡ï¼šÂ¥XX,XXX
- å®Ÿå£²ä¾¡æ ¼ï¼šÂ¥XX,XXX
- å‰²å¼•ç‡ï¼šXX%

### 3. å•†å“ã‚«ãƒ†ã‚´ãƒª
- å¤§åˆ†é¡ï¼š[ã‚«ãƒ†ã‚´ãƒª]
- ä¸­åˆ†é¡ï¼š[ã‚«ãƒ†ã‚´ãƒª]
- å°åˆ†é¡ï¼š[ã‚«ãƒ†ã‚´ãƒª]

[ä»¥ä¸‹ã€æ®‹ã‚Šã®é …ç›®ã‚’å«ã‚€å®Œå…¨ãªå¸‚å ´èª¿æŸ»ãƒ¬ãƒãƒ¼ãƒˆ...]

## B. å¸‚å ´ãƒ»ç«¶åˆã«é–¢ã™ã‚‹é …ç›®ï¼ˆ10é …ç›®ï¼‰
[è©³ç´°ãªç«¶åˆåˆ†æ...]

## C. è²©å£²æˆ¦ç•¥ãƒ»ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³è¦–ç‚¹ï¼ˆ10é …ç›®ï¼‰
[è©³ç´°ãªè²©å£²æˆ¦ç•¥åˆ†æ...]
"""
        
        file_path = self.save_file("phase1", "å¸‚å ´èª¿æŸ».md", research_content)
        print(f"\nå¸‚å ´èª¿æŸ»ãŒå®Œäº†ã—ã¾ã—ãŸã€‚çµæœã‚’ã€Œ{file_path}ã€ã«å‡ºåŠ›ã—ã¾ã—ãŸã€‚")
        print("\nå†…å®¹ã‚’ã”ç¢ºèªã„ãŸã ãã€ä¿®æ­£ãŒå¿…è¦ãªå ´åˆã¯ã”æŒ‡ç¤ºãã ã•ã„ã€‚")
        print("å•é¡Œãªã‘ã‚Œã°ã€Œã‚¹ãƒ†ãƒƒãƒ—2ã¸é€²ã‚€ã€ã¨ã”æŒ‡ç¤ºãã ã•ã„ã€‚")
        
    def execute_phase1_step2(self):
        """Phase1 ã‚¹ãƒ†ãƒƒãƒ—2: ãƒšãƒ«ã‚½ãƒŠè¨­è¨ˆ"""
        print("\nã€ã‚¹ãƒ†ãƒƒãƒ—2ï¼šã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ†æãƒ»ãƒšãƒ«ã‚½ãƒŠè¨­è¨ˆã‚’é–‹å§‹ã—ã¾ã™ã€‘")
        
        persona_content = f"""# ãƒšãƒ«ã‚½ãƒŠè¨­è¨ˆãƒ¬ãƒãƒ¼ãƒˆ

ä½œæˆæ—¥: {datetime.datetime.now().strftime('%Yå¹´%mæœˆ%dæ—¥')}
ã‚»ãƒƒã‚·ãƒ§ãƒ³ID: {self.session_id}

## ãƒšãƒ«ã‚½ãƒŠ1ï¼šãƒ¡ã‚¤ãƒ³ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå±¤

### åŸºæœ¬æƒ…å ±
- åå‰ï¼šç”°ä¸­ ç¾å’²ï¼ˆä»®åï¼‰
- å¹´é½¢ï¼š35æ­³
- è·æ¥­ï¼šä¼šç¤¾å“¡ï¼ˆãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°éƒ¨é–€ï¼‰
- å®¶æ—æ§‹æˆï¼šæ—¢å©šã€å­ä¾›2äººï¼ˆå°å­¦ç”Ÿï¼‰
- å±…ä½åœ°ï¼šæ±äº¬éƒ½ä¸–ç”°è°·åŒº

### ãƒ©ã‚¤ãƒ•ã‚¹ã‚¿ã‚¤ãƒ«ã¨ä¾¡å€¤è¦³
[è©³ç´°ãªè¨˜è¿°...]

### ä¸»è¦ãªãƒšã‚¤ãƒ³ãƒã‚¤ãƒ³ãƒˆ
1. [å…·ä½“çš„ãªæ‚©ã¿1]
2. [å…·ä½“çš„ãªæ‚©ã¿2]
3. [å…·ä½“çš„ãªæ‚©ã¿3]

### æœŸå¾…ã™ã‚‹ã‚²ã‚¤ãƒ³
1. [æœŸå¾…ã™ã‚‹æˆæœ1]
2. [æœŸå¾…ã™ã‚‹æˆæœ2]
3. [æœŸå¾…ã™ã‚‹æˆæœ3]

## ãƒšãƒ«ã‚½ãƒŠ2ï¼šã‚µãƒ–ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå±¤
[è©³ç´°ãªè¨˜è¿°...]

## ãƒšãƒ«ã‚½ãƒŠ3ï¼šæ½œåœ¨ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå±¤
[è©³ç´°ãªè¨˜è¿°...]
"""
        
        file_path = self.save_file("phase1", "ãƒšãƒ«ã‚½ãƒŠè¨­è¨ˆ.md", persona_content)
        print(f"\nã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ†æãƒ»ãƒšãƒ«ã‚½ãƒŠè¨­è¨ˆãŒå®Œäº†ã—ã¾ã—ãŸã€‚")
        print(f"çµæœã‚’ã€Œ{file_path}ã€ã«å‡ºåŠ›ã—ã¾ã—ãŸã€‚")
        print("\n3ã¤ã®ãƒšãƒ«ã‚½ãƒŠã‚’ä½œæˆã—ã¾ã—ãŸï¼š")
        print("- ãƒšãƒ«ã‚½ãƒŠ1ï¼šãƒ¡ã‚¤ãƒ³ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå±¤ï¼ˆ30-40ä»£åƒãå¥³æ€§ï¼‰")
        print("- ãƒšãƒ«ã‚½ãƒŠ2ï¼šã‚µãƒ–ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå±¤ï¼ˆ20ä»£ç¾å®¹æ„è­˜é«˜ã„å±¤ï¼‰")
        print("- ãƒšãƒ«ã‚½ãƒŠ3ï¼šæ½œåœ¨ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå±¤ï¼ˆ50ä»£ä»¥ä¸Šã®ã‚¨ã‚¤ã‚¸ãƒ³ã‚°ã‚±ã‚¢å±¤ï¼‰")
        print("\nå†…å®¹ã‚’ã”ç¢ºèªã„ãŸã ãã€ä¿®æ­£ãŒå¿…è¦ãªå ´åˆã¯ã”æŒ‡ç¤ºãã ã•ã„ã€‚")
        print("å•é¡Œãªã‘ã‚Œã°ã€Œã‚¹ãƒ†ãƒƒãƒ—3ã¸é€²ã‚€ã€ã¨ã”æŒ‡ç¤ºãã ã•ã„ã€‚")
        
    def execute_phase1_step3(self):
        """Phase1 ã‚¹ãƒ†ãƒƒãƒ—3: è¨´æ±‚è»¸è¨­è¨ˆ"""
        print("\nã€ã‚¹ãƒ†ãƒƒãƒ—3ï¼šè¨´æ±‚è»¸è¨­è¨ˆï¼ˆ3ãƒ‘ã‚¿ãƒ¼ãƒ³ä½œæˆï¼‰ã‚’é–‹å§‹ã—ã¾ã™ã€‘")
        
        appeal_content = f"""# è¨´æ±‚è»¸è¨­è¨ˆãƒ¬ãƒãƒ¼ãƒˆ

ä½œæˆæ—¥: {datetime.datetime.now().strftime('%Yå¹´%mæœˆ%dæ—¥')}
ã‚»ãƒƒã‚·ãƒ§ãƒ³ID: {self.session_id}

## ãƒ‘ã‚¿ãƒ¼ãƒ³1ï¼šãƒšãƒ«ã‚½ãƒŠ1å‘ã‘ï¼ˆãƒ¡ã‚¤ãƒ³ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå±¤ï¼‰

### è¨´æ±‚è»¸
ã€Œå¿™ã—ã„æ¯æ—¥ã§ã‚‚ã€10ç§’ã§å®Ÿæ„Ÿã§ãã‚‹æœ¬æ ¼ã‚±ã‚¢ã€

### å•†å“ã®ã‚³ã‚¢ãƒãƒªãƒ¥ãƒ¼
æ™‚çŸ­Ã—åŠ¹æœã®ä¸¡ç«‹

### è§£æ±ºã™ã‚‹ãƒšã‚¤ãƒ³
æœã®æº–å‚™æ™‚é–“ãŒãªã„ä¸­ã§ã®ã‚¹ã‚­ãƒ³ã‚±ã‚¢ã®æ‚©ã¿

[è©³ç´°ãªè¨´æ±‚è»¸è¨­è¨ˆ...]

## ãƒ‘ã‚¿ãƒ¼ãƒ³2ï¼šãƒšãƒ«ã‚½ãƒŠ2å‘ã‘ï¼ˆã‚µãƒ–ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå±¤ï¼‰

### è¨´æ±‚è»¸
ã€ŒSNSæ˜ ãˆã™ã‚‹ç´ è‚Œã¥ãã‚Šã®æ–°ç¿’æ…£ã€

[è©³ç´°ãªè¨´æ±‚è»¸è¨­è¨ˆ...]

## ãƒ‘ã‚¿ãƒ¼ãƒ³3ï¼šãƒšãƒ«ã‚½ãƒŠ3å‘ã‘ï¼ˆæ½œåœ¨ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå±¤ï¼‰

### è¨´æ±‚è»¸
ã€Œå¹´é½¢ã«è² ã‘ãªã„ã€å†…å´ã‹ã‚‰è¼ãè‚Œã¸ã€

[è©³ç´°ãªè¨´æ±‚è»¸è¨­è¨ˆ...]
"""
        
        file_path = self.save_file("phase1", "è¨´æ±‚è»¸è¨­è¨ˆ.md", appeal_content)
        print(f"\nè¨´æ±‚è»¸è¨­è¨ˆãŒå®Œäº†ã—ã¾ã—ãŸã€‚çµæœã‚’ã€Œ{file_path}ã€ã«å‡ºåŠ›ã—ã¾ã—ãŸã€‚")
        print("\n3ã¤ã®è¨´æ±‚è»¸ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½œæˆã—ã¾ã—ãŸï¼š")
        print("\nã€ãƒ‘ã‚¿ãƒ¼ãƒ³1ã€‘ãƒšãƒ«ã‚½ãƒŠ1å‘ã‘")
        print("è¨´æ±‚è»¸ï¼šã€Œå¿™ã—ã„æ¯æ—¥ã§ã‚‚ã€10ç§’ã§å®Ÿæ„Ÿã§ãã‚‹æœ¬æ ¼ã‚±ã‚¢ã€")
        print("\nã€ãƒ‘ã‚¿ãƒ¼ãƒ³2ã€‘ãƒšãƒ«ã‚½ãƒŠ2å‘ã‘")
        print("è¨´æ±‚è»¸ï¼šã€ŒSNSæ˜ ãˆã™ã‚‹ç´ è‚Œã¥ãã‚Šã®æ–°ç¿’æ…£ã€")
        print("\nã€ãƒ‘ã‚¿ãƒ¼ãƒ³3ã€‘ãƒšãƒ«ã‚½ãƒŠ3å‘ã‘")
        print("è¨´æ±‚è»¸ï¼šã€Œå¹´é½¢ã«è² ã‘ãªã„ã€å†…å´ã‹ã‚‰è¼ãè‚Œã¸ã€")
        print("\nã©ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã§æœ€çµ‚ãƒ¬ãƒãƒ¼ãƒˆã‚’ä½œæˆã—ã¾ã™ã‹ï¼Ÿ")
        print("ã€Œãƒ‘ã‚¿ãƒ¼ãƒ³1ã€ã€Œãƒ‘ã‚¿ãƒ¼ãƒ³2ã€ã€Œãƒ‘ã‚¿ãƒ¼ãƒ³3ã€ã®ã„ãšã‚Œã‹ã§ã”æŒ‡ç¤ºãã ã•ã„ã€‚")
        
    def create_final_report(self, pattern_num):
        """Phase1 æœ€çµ‚ãƒ¬ãƒãƒ¼ãƒˆä½œæˆ"""
        print(f"\nã€ãƒ‘ã‚¿ãƒ¼ãƒ³{pattern_num}ã§æœ€çµ‚ãƒ¬ãƒãƒ¼ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‘")
        
        # notionãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆ
        notion_dir = self.sessions_dir / self.session_id / "phase1" / "notion"
        notion_dir.mkdir(parents=True, exist_ok=True)
        
        date_str = datetime.datetime.now().strftime('%Y%m%d')
        filename = f"{self.product_name}_ãƒ©ã‚¤ãƒ–ã‚³ãƒãƒ¼ã‚¹è¨´æ±‚è»¸è¨­è¨ˆãƒ¬ãƒãƒ¼ãƒˆ_ãƒ‘ã‚¿ãƒ¼ãƒ³{pattern_num}_{date_str}.md"
        
        report_content = f"""# {self.product_name} ãƒ©ã‚¤ãƒ–ã‚³ãƒãƒ¼ã‚¹è¨´æ±‚è»¸è¨­è¨ˆãƒ¬ãƒãƒ¼ãƒˆ

ãƒ‘ã‚¿ãƒ¼ãƒ³{pattern_num}
ä½œæˆæ—¥: {datetime.datetime.now().strftime('%Yå¹´%mæœˆ%dæ—¥')}
ã‚»ãƒƒã‚·ãƒ§ãƒ³ID: {self.session_id}

## ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼

é¸æŠã•ã‚ŒãŸãƒ‘ã‚¿ãƒ¼ãƒ³{pattern_num}ã®è¨´æ±‚è»¸è¨­è¨ˆã«åŸºã¥ãã€åŠ¹æœçš„ãªãƒ©ã‚¤ãƒ–ã‚³ãƒãƒ¼ã‚¹å±•é–‹ã‚’å®Ÿç¾ã—ã¾ã™ã€‚

[è©³ç´°ãªãƒ¬ãƒãƒ¼ãƒˆå†…å®¹...]

## ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒšãƒ«ã‚½ãƒŠè©³ç´°

[é¸æŠã•ã‚ŒãŸãƒšãƒ«ã‚½ãƒŠã®è©³ç´°ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«...]

## è¨´æ±‚è»¸è¨­è¨ˆè©³ç´°

[ã‚³ã‚¢ãƒãƒªãƒ¥ãƒ¼ã¨è¨´æ±‚ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è©³ç´°...]

## å®Ÿè£…ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

[é…ä¿¡ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚µãƒ³ãƒ—ãƒ«ãªã©...]

## ã‚¯ã‚¤ãƒƒã‚¯ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹

[ã‚­ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¸€è¦§ãªã©...]
"""
        
        file_path = notion_dir / filename
        with open(file_path, 'w', encoding='utf-8') as f:
            f.write(report_content)
            
        print(f"\næœ€çµ‚ãƒ¬ãƒãƒ¼ãƒˆã®ä½œæˆãŒå®Œäº†ã—ã¾ã—ãŸã€‚")
        print(f"\nä¿å­˜å…ˆï¼š{file_path}")
        print("\nPhase1ãŒå®Œäº†ã—ã¾ã—ãŸã€‚")
        print(f"ã‚»ãƒƒã‚·ãƒ§ãƒ³IDï¼š{self.session_id}")
        print("\næˆæœç‰©ï¼š")
        print("- å¸‚å ´èª¿æŸ»ãƒ¬ãƒãƒ¼ãƒˆ")
        print("- ãƒšãƒ«ã‚½ãƒŠè¨­è¨ˆæ›¸")
        print("- è¨´æ±‚è»¸è¨­è¨ˆæ›¸")
        print("- æœ€çµ‚ãƒ¬ãƒãƒ¼ãƒˆï¼ˆnotion/ï¼‰")
        print("\nPhase2ï¼ˆå°æœ¬ä½œæˆï¼‰ã«é€²ã¿ã¾ã™ã‹ï¼Ÿ")
        print("ã€ŒPhase2ã¸é€²ã‚€ã€ã¨ã”æŒ‡ç¤ºãã ã•ã„ã€‚")
        
    def execute_phase2(self):
        """Phase2: å°æœ¬ä½œæˆ"""
        print("\nã€Phase2ï¼šå°æœ¬ä½œæˆã‚’é–‹å§‹ã—ã¾ã™ã€‘")
        
        # Phase1æˆæœç‰©ã®ç¢ºèª
        notion_dir = self.sessions_dir / self.session_id / "phase1" / "notion"
        reports = list(notion_dir.glob("*.md"))
        
        if not reports:
            print("ã‚¨ãƒ©ãƒ¼ï¼šPhase1ã®æœ€çµ‚ãƒ¬ãƒãƒ¼ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚")
            return
            
        print(f"\nPhase1ã®æˆæœç‰©ã‚’ç¢ºèªã—ã¾ã—ãŸï¼š{reports[0].name}")
        print("\nphase2ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã—ã¾ã—ãŸã€‚")
        print("ã‚¹ãƒ†ãƒƒãƒ—1ï¼š3ã¤ã®ä»•æ§˜è¨­è¨ˆã‚’ä½œæˆã—ã¾ã™ã€‚")
        
        # 3ã¤ã®ä»•æ§˜è¨­è¨ˆã‚’ä½œæˆ
        self.create_hook_script_spec()
        self.create_offer_spec()
        self.create_chapter_spec()
        
        print("\n3ã¤ã®ä»•æ§˜è¨­è¨ˆãŒå®Œäº†ã—ã¾ã—ãŸã€‚")
        print("\nä½œæˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ï¼š")
        print("- phase2/1åˆ†ãƒ•ãƒƒã‚¯å°æœ¬ä»•æ§˜.md")
        print("- phase2/å…±é€šã‚ªãƒ•ã‚¡ãƒ¼è¨­è¨ˆ.md")
        print("- phase2/15åˆ†ãƒãƒ£ãƒ—ã‚¿ãƒ¼æ§‹æˆ.md")
        print("\nå†…å®¹ã‚’ã”ç¢ºèªã„ãŸã ãã€ä¿®æ­£ãŒå¿…è¦ãªå ´åˆã¯ã”æŒ‡ç¤ºãã ã•ã„ã€‚")
        print("å•é¡Œãªã‘ã‚Œã°ã€Œå•é¡Œãªã—ã€ã¨ã”å›ç­”ãã ã•ã„ã€‚")
        
    def create_hook_script_spec(self):
        """1åˆ†ãƒ•ãƒƒã‚¯å°æœ¬ä»•æ§˜ã‚’ä½œæˆ"""
        content = f"""# 1åˆ†ãƒ•ãƒƒã‚¯å°æœ¬ä»•æ§˜

ä½œæˆæ—¥: {datetime.datetime.now().strftime('%Yå¹´%mæœˆ%dæ—¥')}
ã‚»ãƒƒã‚·ãƒ§ãƒ³ID: {self.session_id}

## è¨­è¨ˆãƒãƒªã‚·ãƒ¼
- å•†å“èª¬æ˜ã§ã¯ãªãã€Œè¦–è´è€…ã®æ„Ÿæƒ…ã®ã‚¹ã‚¤ãƒƒãƒã€ã‚’å…¥ã‚Œã‚‹ã“ã¨ãŒå”¯ä¸€ã®ç›®çš„
- ã‚¹ãƒšãƒƒã‚¯ã‚„æ©Ÿèƒ½ã®è¨´æ±‚ã¯å«ã‚ãªã„

## æ§‹æˆãƒ•ãƒ¬ãƒ¼ãƒ ï¼ˆæ„Ÿæƒ…è¨­è¨ˆãƒ™ãƒ¼ã‚¹ï¼‰

### â‘  å°å…¥ï¼ˆå­£ç¯€Ã—æ‚©ã¿ï¼‰- 10ç§’
**ã‚»ãƒªãƒ•ä¾‹ï¼š**
ã€ŒãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ï¼æœ€è¿‘æœèµ·ããŸæ™‚ã®è‚Œã®æ„Ÿã˜ã€ãªã‚“ã‹é•ã„ã¾ã›ã‚“ã‹ï¼Ÿã€

**æ„Ÿæƒ…ã®ç‹™ã„ï¼š**
ã€Œä»Šã¡ã‚‡ã†ã©å›°ã£ã¦ã‚‹ã€ã¨ã„ã†å…±æ„Ÿã‚’å¼•ãå‡ºã™

### â‘¡ å…±æ„Ÿï¼ˆè‡ªå·±ï¼‹ä»–è€…ï¼‰- 15ç§’
**ã‚»ãƒªãƒ•ä¾‹ï¼š**
ã€Œç§ã‚‚åŒã˜ã§ã—ãŸã€‚æœã®æ´—é¡”å¾Œã€ã™ãã«ä¹¾ç‡¥ã‚’æ„Ÿã˜ã¦...å‹äººã‚‚åŒã˜ã“ã¨ã‚’è¨€ã£ã¦ã„ã¦ã€‚ã€

**æ„Ÿæƒ…ã®ç‹™ã„ï¼š**
ã€Œãã‚Œç§ã‚‚ï¼ã€ã¨ã„ã†å¼·ã„å…±æ„Ÿ

[ä»¥ä¸‹ã€è©³ç´°ãªä»•æ§˜...]
"""
        self.save_file("phase2", "1åˆ†ãƒ•ãƒƒã‚¯å°æœ¬ä»•æ§˜.md", content)
        
    def create_offer_spec(self):
        """å…±é€šã‚ªãƒ•ã‚¡ãƒ¼è¨­è¨ˆã‚’ä½œæˆ"""
        content = f"""# å…±é€šã‚ªãƒ•ã‚¡ãƒ¼è¨­è¨ˆ

ä½œæˆæ—¥: {datetime.datetime.now().strftime('%Yå¹´%mæœˆ%dæ—¥')}
ã‚»ãƒƒã‚·ãƒ§ãƒ³ID: {self.session_id}

## åŸºæœ¬æ§‹æˆï¼ˆ3æ®µéšè¨­è¨ˆï¼‰

### â‘  ã‚¢ãƒ³ã‚«ãƒªãƒ³ã‚°ä¾¡æ ¼
- é€šå¸¸ä¾¡æ ¼ï¼šÂ¥5,980ï¼ˆé€æ–™è¾¼ãƒ»å®šä¾¡ï¼‰
- ã‚ãˆã¦é«˜ã‚ã®ä¾¡æ ¼ã‚’æœ€åˆã«æç¤º

### â‘¡ ä¸€èˆ¬ã‚ªãƒ•ã‚¡ãƒ¼
- é…ä¿¡ç‰¹åˆ¥ä¾¡æ ¼ï¼šÂ¥3,980ï¼ˆ33%OFFï¼‰
- é…ä¿¡ä¸­ã®æ¨™æº–ã‚ªãƒ•ã‚¡ãƒ¼

### â‘¢ ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚ªãƒ•ã‚¡ãƒ¼
- 180ç§’é™å®šä¾¡æ ¼ï¼šÂ¥2,980ï¼ˆ50%OFFï¼‰
- ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³æ¼”å‡ºä»˜ã

[ä»¥ä¸‹ã€è©³ç´°ãªè¨­è¨ˆ...]
"""
        self.save_file("phase2", "å…±é€šã‚ªãƒ•ã‚¡ãƒ¼è¨­è¨ˆ.md", content)
        
    def create_chapter_spec(self):
        """15åˆ†ãƒãƒ£ãƒ—ã‚¿ãƒ¼æ§‹æˆã‚’ä½œæˆ"""
        content = f"""# 15åˆ†ãƒãƒ£ãƒ—ã‚¿ãƒ¼æ§‹æˆ

ä½œæˆæ—¥: {datetime.datetime.now().strftime('%Yå¹´%mæœˆ%dæ—¥')}
ã‚»ãƒƒã‚·ãƒ§ãƒ³ID: {self.session_id}

## æ§‹æˆï¼ˆ1:2:5:3:3:1ï¼‰

### 0. HOOKï¼ˆ1åˆ†ï¼‰
- 1åˆ†ãƒ•ãƒƒã‚¯ä»•æ§˜ã‚’é©ç”¨
- è¦–è´è€…ã®æ„Ÿæƒ…ã‚¹ã‚¤ãƒƒãƒã‚’å…¥ã‚Œã‚‹

### 1. ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ2åˆ†ï¼‰
- ä¿¡é ¼é–¢ä¿‚æ§‹ç¯‰
- ã‚³ãƒ¡ãƒ³ãƒˆèª˜å°

### 2. ãƒ†ãƒ¼ãƒæ·±æ˜ã‚Šï¼ˆ5åˆ†ï¼‰
- ãƒãƒ£ãƒ—ã‚¿ãƒ¼åˆ¥è¨­è¨ˆã‚’é©ç”¨
- ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å±•é–‹

[ä»¥ä¸‹ã€è©³ç´°ãªæ§‹æˆ...]
"""
        self.save_file("phase2", "15åˆ†ãƒãƒ£ãƒ—ã‚¿ãƒ¼æ§‹æˆ.md", content)
        
    def create_final_scripts(self):
        """æœ€çµ‚å°æœ¬ã‚’ä½œæˆ"""
        print("\nã€å°æœ¬æœ€çµ‚ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆã‚’ä½œæˆã—ã¾ã™ã€‘")
        
        # commercerãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆ
        commercer_dir = self.sessions_dir / self.session_id / "phase2" / "commercer"
        commercer_dir.mkdir(parents=True, exist_ok=True)
        
        date_str = datetime.datetime.now().strftime('%Y%m%d')
        
        # ã‚³ãƒãƒ¼ã‚µãƒ¼ç”¨å°æœ¬
        commercer_script = f"""# {self.product_name} ã‚³ãƒãƒ¼ã‚µãƒ¼ç”¨å°æœ¬

ä½œæˆæ—¥: {datetime.datetime.now().strftime('%Yå¹´%mæœˆ%dæ—¥')}
ã‚»ãƒƒã‚·ãƒ§ãƒ³ID: {self.session_id}

## ğŸ“Œ1åˆ†ãƒ•ãƒƒã‚¯ï¼ˆç‹¬ç«‹ãƒšãƒ¼ã‚¸ï¼‰

### ğŸ¯ æ„Ÿæƒ…ãƒˆãƒªã‚¬ãƒ¼ï¼šå…±æ„Ÿ
### ğŸ—£ï¸ ãƒˆãƒ¼ã‚¯ã®æµã‚Œãƒ¡ãƒ¢
1. æœã®è‚Œã®é•å’Œæ„Ÿã‹ã‚‰å…¥ã‚‹
2. è‡ªåˆ†ã®ä½“é¨“ã‚’èªã‚‹
3. ç†æƒ³ã®çŠ¶æ…‹ã‚’æå†™

### ğŸ’¬ ã‚»ãƒªãƒ•ãƒ’ãƒ³ãƒˆ
ã€ŒãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ï¼ä»Šæ—¥ã‚‚ãƒ©ã‚¤ãƒ–é…ä¿¡ã«ãŠè¶Šã—ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚
æœ€è¿‘ã­ã€æœèµ·ããŸæ™‚ã®è‚Œã®æ„Ÿã˜ã€ãªã‚“ã‹é•ã†ãªã£ã¦æ„Ÿã˜ã‚‹ã“ã¨ã‚ã‚Šã¾ã›ã‚“ã‹ï¼Ÿã€

[ä»¥ä¸‹ã€è©³ç´°ãªå°æœ¬å†…å®¹...]
"""
        
        # ç¾å ´ç”¨å°æœ¬
        field_script = f"""# {self.product_name} ç¾å ´ç”¨å°æœ¬

ä½œæˆæ—¥: {datetime.datetime.now().strftime('%Yå¹´%mæœˆ%dæ—¥')}
ã‚»ãƒƒã‚·ãƒ§ãƒ³ID: {self.session_id}

| ãƒãƒ£ãƒ—ã‚¿ãƒ¼å | æ™‚é–“ | å°è©æ¦‚è¦ | ãƒ†ãƒ­ãƒƒãƒ— | ãƒ•ãƒªãƒƒãƒ— | å›ºå®šã‚³ãƒ¡ãƒ³ãƒˆ | ã‚ªãƒ•ã‚¡ãƒ¼ | æ¼”å‡ºæŒ‡ç¤º |
|-------------|------|----------|----------|----------|-------------|----------|----------|
| 1åˆ†ãƒ•ãƒƒã‚¯å°å…¥ | 02:00â€“03:00 | æœã®è‚Œé•å’Œæ„Ÿâ†’å…±æ„Ÿ | ã€Œ"æœã®è‚ŒãŒã¤ã‚‰ã„"ã‚’å¤‰ãˆã‚‹ã€ | ãªã— | ã€Œæœã®è‚Œã€æ°—ã«ãªã‚Šã¾ã›ã‚“ã‹ï¼Ÿã€ | ã¾ã å‡ºã•ãªã„ | ã‚³ãƒ¡ãƒ³ãƒˆæ‹¾ã„ä¸€æ™‚åœæ­¢/è¡¨æƒ…ã‚„ã‚ã‚‰ã‹ã |
| ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | 03:00â€“05:00 | è¦–è´è€…ã¨ã®é–¢ä¿‚æ§‹ç¯‰ | ã€Œã‚ãªãŸã®æ‚©ã¿ã€æ•™ãˆã¦ãã ã•ã„ã€ | ãªã— | ã€Œã‚³ãƒ¡ãƒ³ãƒˆãŠå¾…ã¡ã—ã¦ã„ã¾ã™ã€ | ã¾ã å‡ºã•ãªã„ | ã‚³ãƒ¡ãƒ³ãƒˆç©æ¥µçš„ã«æ‹¾ã† |

[ä»¥ä¸‹ã€è©³ç´°ãªé€²è¡Œè¡¨...]
"""
        
        # ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜
        commercer_path = commercer_dir / f"{self.product_name}_ã‚³ãƒãƒ¼ã‚µãƒ¼ç”¨å°æœ¬_{date_str}.md"
        field_path = commercer_dir / f"{self.product_name}_ç¾å ´ç”¨å°æœ¬_{date_str}.md"
        
        with open(commercer_path, 'w', encoding='utf-8') as f:
            f.write(commercer_script)
        with open(field_path, 'w', encoding='utf-8') as f:
            f.write(field_script)
            
        print(f"\nå°æœ¬æœ€çµ‚ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆã®ä½œæˆãŒå®Œäº†ã—ã¾ã—ãŸã€‚")
        print(f"\nä¿å­˜å…ˆï¼š")
        print(f"- {commercer_path}")
        print(f"- {field_path}")
        print("\nå°æœ¬åˆ¶ä½œãŒå®Œäº†ã—ã¾ã—ãŸã€‚")
        print(f"ã‚»ãƒƒã‚·ãƒ§ãƒ³IDï¼š{self.session_id}")
        print("\nå…¨æˆæœç‰©ã¯ä»¥ä¸‹ã«ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™ï¼š")
        print(f"sessions/{self.session_id}/")
        print("\nä¸»è¦ãªæˆæœç‰©ï¼š")
        print("- ã‚³ãƒãƒ¼ã‚µãƒ¼ç”¨å°æœ¬")
        print("- ç¾å ´ç”¨å°æœ¬")
        print("\nã“ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ä½œæ¥­ã¯å®Œäº†ã§ã™ã€‚")
        print("æ–°ã—ã„å°æœ¬ã‚’ä½œæˆã™ã‚‹å ´åˆã¯ã€å†åº¦ã€Œå°æœ¬åˆ¶ä½œã‚’å®Ÿè¡Œã€ã¨ã”æŒ‡ç¤ºãã ã•ã„ã€‚")
        
    def run(self):
        """ãƒ¡ã‚¤ãƒ³å®Ÿè¡Œé–¢æ•°"""
        print("ãƒ©ã‚¤ãƒ–ã‚³ãƒãƒ¼ã‚¹å°æœ¬åˆ¶ä½œã‚·ã‚¹ãƒ†ãƒ ã¸ã‚ˆã†ã“ãï¼")
        print("\nã€Œå°æœ¬åˆ¶ä½œã‚’å®Ÿè¡Œã€ã¨å…¥åŠ›ã—ã¦ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’é–‹å§‹ã—ã¦ãã ã•ã„ã€‚")
        
        while True:
            user_input = input("\n> ").strip()
            
            if user_input in ["å°æœ¬åˆ¶ä½œã‚’å®Ÿè¡Œ", "æ–°ã—ã„å°æœ¬ã‚’ä½œæˆ", "ãƒ©ã‚¤ãƒ–ã‚³ãƒãƒ¼ã‚¹å°æœ¬ã‚’ä½œã‚ŠãŸã„"]:
                self.initialize_session()
                
                # å•†å“URLå…¥åŠ›å¾…ã¡
                self.product_url = input("\nå•†å“URL> ").strip()
                if not self.product_url:
                    print("URLãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚")
                    continue
                    
                # å•†å“åã®è¨­å®šï¼ˆãƒ‡ãƒ¢ç”¨ï¼‰
                self.product_name = "ã‚µãƒ³ãƒ—ãƒ«å•†å“"
                print(f"\nå•†å“URLã€Œ{self.product_url}ã€ã‚’ç¢ºèªã—ã¾ã—ãŸã€‚")
                print("phase1ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã—ã¾ã—ãŸã€‚")
                print("ã‚¹ãƒ†ãƒƒãƒ—1ï¼šå¸‚å ´èª¿æŸ»ã‚’é–‹å§‹ã—ã¾ã™ã€‚")
                
                # Phase1 å®Ÿè¡Œ
                self.execute_phase1_step1()
                
            elif user_input == "ã‚¹ãƒ†ãƒƒãƒ—2ã¸é€²ã‚€":
                self.execute_phase1_step2()
                
            elif user_input == "ã‚¹ãƒ†ãƒƒãƒ—3ã¸é€²ã‚€":
                self.execute_phase1_step3()
                
            elif user_input.startswith("ãƒ‘ã‚¿ãƒ¼ãƒ³"):
                pattern_num = user_input[-1]
                if pattern_num in ["1", "2", "3"]:
                    self.create_final_report(pattern_num)
                    
            elif user_input == "Phase2ã¸é€²ã‚€":
                self.execute_phase2()
                
            elif user_input == "å•é¡Œãªã—":
                self.create_final_scripts()
                
            elif user_input in ["exit", "quit", "çµ‚äº†"]:
                print("ã‚·ã‚¹ãƒ†ãƒ ã‚’çµ‚äº†ã—ã¾ã™ã€‚")
                break
                
            else:
                print("èªè­˜ã§ããªã„ã‚³ãƒãƒ³ãƒ‰ã§ã™ã€‚")
                print("ä½¿ç”¨å¯èƒ½ãªã‚³ãƒãƒ³ãƒ‰ï¼š")
                print("- å°æœ¬åˆ¶ä½œã‚’å®Ÿè¡Œ")
                print("- ã‚¹ãƒ†ãƒƒãƒ—2ã¸é€²ã‚€")
                print("- ã‚¹ãƒ†ãƒƒãƒ—3ã¸é€²ã‚€")
                print("- ãƒ‘ã‚¿ãƒ¼ãƒ³1/2/3")
                print("- Phase2ã¸é€²ã‚€")
                print("- å•é¡Œãªã—")
                print("- exit/quit/çµ‚äº†")

if __name__ == "__main__":
    generator = LiveCommerceScriptGenerator()
    generator.run()